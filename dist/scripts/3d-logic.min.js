import*as THREE from"three";import{GLTFLoader}from"three/addons/loaders/GLTFLoader.js";import{OrbitControls}from"three/addons/controls/OrbitControls.js";const scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.01,1e3),renderer=new THREE.WebGLRenderer;renderer.setSize(window.innerWidth,window.innerHeight),renderer.setClearColor(14540253,1),document.body.appendChild(renderer.domElement),camera.position.set(0,0,5);const ambientLight=new THREE.AmbientLight(4210752,1);scene.add(ambientLight);const directionalLight=new THREE.DirectionalLight(16777215,1);directionalLight.position.set(1,1,1).normalize(),scene.add(directionalLight);const loader=new GLTFLoader;let model,originalColors=new Map;const changeColor=document.querySelector("#changeColor"),meshNameToChange="Circle003";loader.load("assets/models/armatura1_LOD0.glb",(function(e){model=e.scene,model.traverse((e=>{e.isMesh&&e.material&&originalColors.set(e,e.material.color.clone())})),changeColor.addEventListener("click",(function(){model.traverse((e=>{e.isMesh&&e.material&&"Circle003"===e.name&&(e.material.color.equals(new THREE.Color(255))?e.material.color.copy(originalColors.get(e)):e.material.color.set(255))}))})),scene.add(model)}),void 0,(function(e){console.error("Ошибка загрузки модели:",e)}));const controls=new OrbitControls(camera,renderer.domElement);let isDragging=!1,selectedObject=null;function getIntersectedObject(e){const n=new THREE.Vector2;n.x=e.clientX/window.innerWidth*2-1,n.y=-e.clientY/window.innerHeight*2+1;const t=new THREE.Raycaster;t.setFromCamera(n,camera);return t.intersectObjects(scene.children).length>0?model:null}document.addEventListener("mousedown",(function(e){const n=getIntersectedObject(e);n&&(isDragging=!0,selectedObject=n,controls.enableRotate=!1)})),document.addEventListener("mouseup",(function(e){isDragging=!1,selectedObject=null,controls.enableRotate=!0})),document.addEventListener("mousemove",(function(e){if(isDragging&&selectedObject){const n=new THREE.Vector2;n.x=e.clientX/window.innerWidth*2-1,n.y=-e.clientY/window.innerHeight*2+1;const t=new THREE.Raycaster;t.setFromCamera(n,camera);const o=new THREE.Plane(new THREE.Vector3(0,0,1),0),r=new THREE.Vector3;t.ray.intersectPlane(o,r),selectedObject.position.copy(r)}}));const modalWindow=document.querySelector("#mw");function animate(){requestAnimationFrame(animate),controls.update(),renderer.render(scene,camera)}document.addEventListener("click",(function(e){const n=new THREE.Vector2;n.x=e.clientX/window.innerWidth*2-1,n.y=-e.clientY/window.innerHeight*2+1;const t=new THREE.Raycaster;t.setFromCamera(n,camera);t.intersectObjects(scene.children).length>0&&modalWindow.classList.toggle("show-mw")})),animate(),window.addEventListener("resize",(()=>{camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}));